---
title: "D208 Predictive Modeling"
subtitle: "College of Information Technology, Western Governors University"
author: "Tyson Biegler"
date: "`r format(Sys.Date(), '%B %d, %Y')`"
output: html_document
---

```{r include=FALSE, echo=FALSE, warning=FALSE}
# Initial Setup -----------------------------------------------------------

# Install required packages. only installs if not already installed. 
# Data manipulation and visualization
if (!requireNamespace("tidyverse", quietly = TRUE)) install.packages("tidyverse")  

# Stepwise regression (stepAIC)
if (!requireNamespace("MASS", quietly = TRUE)) install.packages("MASS")    

# Multicollinearity diagnostics (VIF)
if (!requireNamespace("car", quietly = TRUE)) install.packages("car") 

# Model  diagnostics and assumption checks
if (!requireNamespace("performance", quietly = TRUE)) install.packages("performance") 

# Train-test splits and model utility functions
if (!requireNamespace("caret", quietly = TRUE)) install.packages("caret") 

# Summary tables for models
if (!requireNamespace("gtsummary", quietly = TRUE)) install.packages("gtsummary")

# Visualize model predictions
if (!requireNamespace("ggeffects", quietly = TRUE)) install.packages("ggeffects")

# Create polished tables for reports
if (!requireNamespace("flextable", quietly = TRUE)) install.packages("flextable")  



library(tidyverse)    
library(MASS)         # Stepwise regression with (stepAIC)
library(car)          # Multicollinearity with (VIF)
library(performance)  # Model diagnostics and assumption checks
library(caret)        # Train-test splits
library(gtsummary)    # Summary tables for models
library(ggeffects)    # Visualize model predictions
library(flextable)    # Create tables

# Set wd ------------------------------------------------------------------
setwd('C:/Users/tyson/Documents/GitHub/WGU_MSDA_Portfolio/Predictive Modeling – D208/R/Raw')

# Get data ----------------------------------------------------------------
churn <- read_csv("churn_clean.csv")
theme_set(theme_minimal())

```

# Part I: Research Question

### *"What factors impact customer tenure?"*

**A1:** The average customer Tenure is 35.5 months or 2.88 years. I will investigate the factors that impact customer tenure since letting a customer go rather than retaining them can be a significant detriment to the company's profit, as noted by Amy Gallo of Harvard Business Review: “...acquiring a new customer is anywhere from five to 25 times more expensive than retaining an existing one” **(Gallo, 2014)**.

**A2:** This analysis aims to create a multiple linear regression model that will assist in predicting customer tenure. Knowing the factors that increase or decrease the customer’s tenure will help the executives make data-informed decisions that will benefit the company and keep the customer happy.

# Part II: Method Justification

**B1:** There are four assumptions of linear regression **(Z. Bobbit, 2020)**.

1.  A linear relationship exists between the dependent and independent variables.

2.  The variance of the residuals follows a normal distribution.

3.  The residuals are homoscedastic. In other words, the residual plot should not show any signs of a pattern.

4.  The residuals are independent. The residuals cannot be dependent on the surrounding points. While there are only four assumptions to a linear model, other factors must be considered **(G. Martin, n.d.)**.

    1.  Multi-collinearity should be minimized so multiple variables do not tell the same story. Multi-collinearity occurs when the independent variables are correlated with each other.

    2.  Outliers of residuals. Residuals can have high leverage and outside of 2 standard deviations, meaning that they have a large impact on the coefficients of the data and are outliers. Like any other outlier, these outliers should be investigated further to determine whether they should be removed or retained.

**B2:** I will be using R within R-Studio to perform this analysis. While Python can perform this same statistical analysis, it was not explicitly designed for this purpose. R, on the other hand, was specifically designed for statistical analysis **(Ihaka, n.d., p. 12)**. Due to this, R is the more logical choice for performing statistical tasks. Secondly, I have more experience using R than I do with Python. I've used R to complete previous courses, and I feel that it is more intuitive than Python. 

**B3:** Tenure is a continuous variable representing the months a customer has been with the company, making it a valuable metric for understanding customer retention. Tenure can be influenced by numerous numeric and categorical variables simultaneously, making multiple regression a viable option to consider, assuming all of the assumptions in B1 are met.  

# Part III: Data Preparation

```{r echo=FALSE}
# Exploring the Data ------------------------------------------------------
#getting a general understanding of the data
glimpse(churn)

#checking for na and duplicates
sum(is.na(churn))
sum(duplicated(churn))

# Clearn/Prepare Data -----------------------------------------------------

#renaming the survey response columns to be more intuitive
churn <- churn %>%
  mutate_at(vars(43:50), as.factor) %>%
  rename_at(vars(43:50), ~ c(
    "Timely_response",
    "Timely_fixes",
    "Timely_replacements",
    "Reliability",
    "Options",
    "Respectful",
    "Courteous",
    "Active_listening"
  ))




#Verifying that the column names have been updated successfully
names(churn)


# Convert Specific Columns to binary/factor
churn <- churn %>%
  mutate(across(c(Churn, 
                  Techie, 
                  Port_modem, 
                  Tablet, 
                  Phone, 
                  Multiple,
                  OnlineSecurity, 
                  OnlineBackup, 
                  DeviceProtection, 
                  TechSupport,
                  StreamingTV, 
                  StreamingMovies, 
                  PaperlessBilling),
                ~ as.factor(ifelse(trimws(.) == 'Yes', 1, 0))))

# Convert Specific Columns to Factors
churn <- churn %>%
  mutate_at(vars(Area, 
                 Marital, 
                 Gender,
                 Contract,
                 InternetService,
                 PaymentMethod, 
                 City,
                 State,
                 ),
            as.factor)

# Convert Specific Columns to Numeric
churn <- churn %>%
  mutate_at(vars(Tenure,
                 MonthlyCharge,
                 Bandwidth_GB_Year,
                 Outage_sec_perweek
                 ),
            as.numeric)

# Convert Specific Columns to Integer
churn <- churn %>% 
  mutate_at(vars(Children,
                 Age,
                 Population,
                 Email,
                 Contacts,
                 Yearly_equip_failure),
            as.integer)

glimpse(churn)
str(churn)

#Removing columns im not going to use
churn <- churn[, !(names(churn) %in% c("CaseOrder", 
                                       "Customer_id", 
                                       "Interaction",
                                       "UID",
                                       "Lat", 
                                       "Lng",
                                       "County", 
                                       "Zip",
                                       "Area", 
                                       "TimeZone", 
                                       "Job",
                                       "City", 
                                       "State"
                                       ))]

str(churn)

write.csv(churn, "CLEANED_churn.csv")
```
